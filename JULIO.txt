CREATE TABLE CLIENTE
(
IDCLIENTE int,
CEDULACLIENTE varchar(10),
NOMBRECLIENTO varchar(20),
APELLIDOCLIENTE varchar(20),
FECHAREGISTROCLIENTE date
 constraint pk_cliente primary key nonclustered (IDCLIENTE)
);

SELECT * FROM CLIENTE

CREATE TABLE PELICULA
(
IDPELICULA int,
NOMBREPELICULA varchar(10),
ANIOESTRENO varchar(20),
 constraint pk_pelicula primary key nonclustered (IDPELICULA)
);

SELECT * FROM PELICULA

CREATE TABLE ALQUILER(
IDALQUILER int,
IDCLIENTEFK int,
IDPELICULAFK int,
FECHAPRESTAMO date,
FECHAENTREGA date,
VALOR float (30),
 constraint pk_alquiler primary key nonclustered (IDALQUILER)
);

DROP TABLE PELICULA




alter table ALQUILER
   add constraint FK_ALQUILER foreign key (IDCLIENTEFK)
      references CLIENTE (IDCLIENTE)
go

alter table ALQUILER
   add constraint FK_ALQUILER2 foreign key (IDPELICULAFK)
      references PELICULA (IDPELICULA)
go



	   
INSERT INTO CLIENTE(IDCLIENTE,CEDULACLIENTE,NOMBRECLIENTO,APELLIDOCLIENTE,FECHAREGISTROCLIENTE) 
VALUES   (1,'123456789','BRYAN','ZAMBRANO','8-09-2021'),
	      (4,'123245','JESUS','ZAMBRANO','8-09-2021'),
		  (3,'213425','ARNALDO','ZAMBRANO','8-09-2021')



INSERT INTO PELICULA(IDPELICULA,NOMBREPELICULA,ANIOESTRENO) 
VALUES   (1,'EL ORIGEN' ,'2021'),
	      (2,'AMOR','2021'),
		  (3,'AGENTE 007','2021')

INSERT INTO ALQUILER(IDALQUILER,IDCLIENTEFK,IDPELICULAFK,FECHAPRESTAMO,FECHAENTREGA) 
VALUES   (1,1,1,'8-09-2021' ,'9-09-2021'),
	      (2,4,2,'8-09-2021','10-09-2021'),
		  (3,3,3,'8-09-2021','11-09-2021')


--TRIGGER
create or alter trigger PELICULAVALOR
on ALQUILER for insert 
as 
begin

	update ALQUILER set ALQUILER.VALOR = p.VALOR 
	from ALQUILER inner join PELICULA p  on ALQUILER.IDPELICULAFK = p.IDPELICULA
	inner join inserted as i on i.IDALQUILER = i.IDALQUILER and i.IDPELICULAFK = p.IDPELICULA

end 

SELECT *FROM ALQUILER
SELECT *FROM PELICULA


INSERT INTO ALQUILER(IDALQUILER,IDCLIENTEFK,IDPELICULAFK,FECHAPRESTAMO,FECHAENTREGA) 
VALUES   (6,1,1,'7-09-2021' ,'9-09-2021'),
	      (7,4,2,'7-09-2021','10-09-2021')





